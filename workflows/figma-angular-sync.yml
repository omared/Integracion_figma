name: ğŸ”„ Figma + Angular Sync

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  sync-figma-angular:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ Clona el repo
      - name: ğŸ“¥ Checkout del cÃ³digo
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Instala Node.js
      - name: ğŸ§° Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      # 3ï¸âƒ£ Instala dependencias
      - name: ğŸ“¦ Instalar dependencias
        run: npm ci

      # 4ï¸âƒ£ Verifica conexiÃ³n con Figma API
      - name: ğŸ” Probar conexiÃ³n con Figma
        run: node test-figma-connection.js
        env:
          FIGMA_TOKEN: ${{ secrets.FIGMA_TOKEN }}
          FIGMA_FILE_KEY: ${{ secrets.FIGMA_FILE_KEY }}

      # 5ï¸âƒ£ (Opcional) Descargar archivo de Figma
      - name: ğŸ“‚ Descargar datos del archivo Figma
        run: |
          mkdir -p figma_data
          curl -H "X-Figma-Token: ${{ secrets.FIGMA_TOKEN }}" \
            https://api.figma.com/v1/files/${{ secrets.FIGMA_FILE_KEY }} \
            -o figma_data/figma-file.json
        continue-on-error: true

      # 6ï¸âƒ£ Compila el proyecto Angular
      - name: ğŸ§± Compilar Angular
        run: |
          npm install -g @angular/cli
          ng build --configuration production

      # 7ï¸âƒ£ (Opcional) Guarda el archivo de Figma descargado como artefacto
      - name: ğŸ“¦ Guardar artefacto de Figma
        uses: actions/upload-artifact@v4
        with:
          name: figma-file
          path: figma_data/figma-file.json
